---
// src/components/TestimonialsSection.astro
import { Image } from 'astro:assets';

// Testimonials data
const testimonials = [
  {
    id: 1,
    quote: "As a professional in the water industry, I was struggling with Legionella CAD drawings. CAD Outsource came to the rescue with their innovative solutions. Their CAD services not only saved us valuable time but also significantly reduced costs. Highly recommended!",
    name: "Linda W",
    position: "Water Industry Professional",
    avatar: "https://images.pexels.com/photos/3184611/pexels-photo-3184611.jpeg"
  },
  {
    id: 2,
    quote: "Working with CAD Outsource has been a game-changer for our HVAC projects. Their 3D modeling expertise and attention to detail are exceptional. The team consistently delivers high-quality work on time and within budget.",
    name: "Michael R",
    position: "HVAC Engineering Manager",
    avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"
  },
  {
    id: 3,
    quote: "The CAD conversion services provided by this team exceeded our expectations. They migrated our entire legacy drawing database to modern CAD software seamlessly. Professional service with outstanding results!",
    name: "Sarah M",
    position: "Project Coordinator",
    avatar: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face"
  },
  {
    id: 4,
    quote: "Excellent 2D drafting services! The precision and turnaround time are remarkable. CAD Outsource has become our go-to partner for all technical drawing requirements. Five stars!",
    name: "David L",
    position: "Mechanical Engineer",
    avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face"
  },
  {
    id: 5,
    quote: "From concept to completion, CAD Outsource delivered exceptional architectural modeling services. Their team understood our vision and brought it to life with stunning 3D visualizations.",
    name: "Emily K",
    position: "Architect",
    avatar: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face"
  }
];
---

<!-- Testimonials Section -->
<section class="relative py-20 md:py-24 overflow-hidden">
  <!-- Background Image with Overlay -->
  <div class="absolute inset-0">
    <Image 
      src="https://images.pexels.com/photos/40142/new-york-skyline-manhattan-hudson-40142.jpeg"
      alt="Professional working on CAD software"
      width={1920}
      height={800}
      class="w-full h-full object-cover"
      loading="lazy"
    />
    <!-- Dark overlay -->
    <div class="absolute inset-0 bg-black/70"></div>
  </div>

  <!-- Content -->
  <div class="relative z-10 container mx-auto px-4 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-12 md:mb-16">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4">
        People Who Loved CAD Outsource
      </h2>
    </div>

    <!-- Testimonials Slider -->
    <div class="relative max-w-4xl mx-auto">
      <!-- Slider Container -->
      <div class="testimonials-slider overflow-hidden">
        <div class="testimonials-track flex transition-transform duration-500 ease-in-out" id="testimonials-track">
          {testimonials.map((testimonial, index) => (
            <div class="testimonial-slide flex-shrink-0 w-full px-4">
              <div class="text-center">
                <!-- Quote -->
                <div class="mb-8">
                  <p class="text-lg md:text-xl lg:text-2xl text-white leading-relaxed italic font-light max-w-3xl mx-auto">
                    "{testimonial.quote}"
                  </p>
                </div>
                
                <!-- Author Info -->
                <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                  <!-- Avatar -->
                  <div class="flex-shrink-0">
                    <Image 
                      src={testimonial.avatar}
                      alt={testimonial.name}
                      width={80}
                      height={80}
                      class="w-16 h-16 md:w-20 md:h-20 rounded-full border-4 border-white/20 shadow-lg"
                      loading="lazy"
                    />
                  </div>
                  
                  <!-- Name and Position -->
                  <div class="text-center sm:text-left">
                    <h4 class="text-yellow-400 font-bold text-lg md:text-xl">
                      {testimonial.name}
                    </h4>
                    <p class="text-white/80 text-sm md:text-base">
                      {testimonial.position}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Navigation Arrows -->
      <button 
        class="prev-btn absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white p-3 rounded-full transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50"
        id="prev-btn"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      <button 
        class="next-btn absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white p-3 rounded-full transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50"
        id="next-btn"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>

    <!-- Dots Indicator -->
    <div class="flex justify-center space-x-3 mt-12" id="dots-container">
      {testimonials.map((_, index) => (
        <button 
          class={`dot w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-white scale-125' : 'bg-white/40 hover:bg-white/60'}`}
          data-index={index}
        ></button>
      ))}
    </div>
  </div>
</section>

<script>
  class TestimonialsSlider {
    private currentSlide: number = 0;
    private totalSlides: number = 0;
    private track: HTMLElement | null = null;
    private dots: NodeListOf<HTMLElement> | null = null;
    private autoPlayInterval: number | null = null;
    private isTransitioning: boolean = false;

    constructor() {
      this.init();
    }

    init(): void {
      // Get DOM elements
      this.track = document.getElementById('testimonials-track');
      this.dots = document.querySelectorAll('.dot');
      this.totalSlides = this.dots?.length || 0;

      if (!this.track || !this.dots) return;

      // Set initial state
      this.updateSlider();

      // Add event listeners
      this.addEventListeners();

      // Start auto-play
      this.startAutoPlay();
    }

    addEventListeners(): void {
      // Previous button
      const prevBtn = document.getElementById('prev-btn');
      prevBtn?.addEventListener('click', () => this.prevSlide());

      // Next button  
      const nextBtn = document.getElementById('next-btn');
      nextBtn?.addEventListener('click', () => this.nextSlide());

      // Dot indicators
      this.dots?.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });

      // Pause auto-play on hover
      const section = document.querySelector('section:has(#testimonials-track)');
      section?.addEventListener('mouseenter', () => this.stopAutoPlay());
      section?.addEventListener('mouseleave', () => this.startAutoPlay());

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') this.prevSlide();
        if (e.key === 'ArrowRight') this.nextSlide();
      });
    }

    updateSlider(): void {
      if (!this.track || !this.dots) return;

      // Update track position
      const translateX = -this.currentSlide * 100;
      this.track.style.transform = `translateX(${translateX}%)`;

      // Update dots
      this.dots.forEach((dot, index) => {
        if (index === this.currentSlide) {
          dot.classList.add('bg-white', 'scale-125');
          dot.classList.remove('bg-white/40');
        } else {
          dot.classList.add('bg-white/40');
          dot.classList.remove('bg-white', 'scale-125');
        }
      });
    }

    nextSlide(): void {
      if (this.isTransitioning) return;
      
      this.isTransitioning = true;
      this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
      this.updateSlider();
      
      setTimeout(() => {
        this.isTransitioning = false;
      }, 500);
    }

    prevSlide(): void {
      if (this.isTransitioning) return;
      
      this.isTransitioning = true;
      this.currentSlide = this.currentSlide === 0 ? this.totalSlides - 1 : this.currentSlide - 1;
      this.updateSlider();
      
      setTimeout(() => {
        this.isTransitioning = false;
      }, 500);
    }

    goToSlide(index: number): void {
      if (this.isTransitioning || index === this.currentSlide) return;
      
      this.isTransitioning = true;
      this.currentSlide = index;
      this.updateSlider();
      
      setTimeout(() => {
        this.isTransitioning = false;
      }, 500);
    }

    startAutoPlay(): void {
      this.stopAutoPlay(); // Clear any existing interval
      this.autoPlayInterval = window.setInterval(() => {
        this.nextSlide();
      }, 5000); // Change slide every 5 seconds
    }

    stopAutoPlay(): void {
      if (this.autoPlayInterval) {
        clearInterval(this.autoPlayInterval);
        this.autoPlayInterval = null;
      }
    }
  }

  // Initialize slider when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    new TestimonialsSlider();
  });

  // Add smooth scroll behavior for better UX
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.querySelector('section:has(#testimonials-track)');
    
    // Add entrance animation
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const slides = entry.target.querySelectorAll('.testimonial-slide');
          slides.forEach((slide, index) => {
            const slideElement = slide as HTMLElement;
            slideElement.style.opacity = '0';
            slideElement.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
              slideElement.style.transition = 'all 0.6s ease-out';
              slideElement.style.opacity = '1';
              slideElement.style.transform = 'translateY(0)';
            }, index * 100);
          });
          
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.3 });

    if (section) {
      observer.observe(section);
    }
  });
</script>

<style>
  /* Enhanced styling for testimonials */
  .testimonials-slider {
    position: relative;
  }

  .testimonial-slide {
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Custom scrollbar for better UX */
  .testimonials-track {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  
  .testimonials-track::-webkit-scrollbar {
    display: none;
  }

  /* Hover effects for navigation */
  .prev-btn:hover,
  .next-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-50%) scale(1.1);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .prev-btn,
    .next-btn {
      display: none;
    }
    
    .testimonial-slide {
      padding: 0 1rem;
    }
  }

  /* Quote styling */
  .testimonial-slide p {
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  }

  /* Avatar hover effect */
  .testimonial-slide img {
    transition: transform 0.3s ease;
  }

  .testimonial-slide:hover img {
    transform: scale(1.05);
  }

  /* Dot animation */
  .dot {
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .dot:hover {
    transform: scale(1.2);
  }
</style>
