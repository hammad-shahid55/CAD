---
// src/components/StatsSection.astro
import { Image } from 'astro:assets';

// Stats data
const stats = [
  {
    number: 565,
    label: "Happy Customers",
    suffix: "+"
  },
  {
    number: 654,
    label: "Project Complete", 
    suffix: "+"
  },
  {
    number: 250,
    label: "Qualified Staff",
    suffix: " +"
  },
  {
    number: 4,
    label: "Year Experience",
    suffix: " +"
  }
];
---

<!-- Statistics Section -->
<section class="relative py-20 md:py-24 overflow-hidden">
  <!-- Background Image with Overlay -->
  <div class="absolute inset-0">
    <Image 
      src="https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=1920&h=800&fit=crop"
      alt="City skyline background"
      width={1920}
      height={800}
      class="w-full h-full object-cover"
      loading="lazy"
    />
    <!-- Dark overlay -->
    <div class="absolute inset-0 bg-black/60"></div>
  </div>

  <!-- Content -->
  <div class="relative z-10 container mx-auto px-4 lg:px-8">
    <!-- Stats Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
      {stats.map((stat, index) => (
        <div class="group text-center">
          <!-- Stats Card -->
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 md:p-8 hover:bg-white/20 transition-all duration-500 transform hover:-translate-y-2 hover:shadow-2xl">
            <!-- Animated Number -->
            <div class="mb-4">
              <span 
                class="stat-number text-4xl md:text-5xl lg:text-6xl font-bold text-white block"
                data-target={stat.number}
                data-suffix={stat.suffix}
              >
                0{stat.suffix}
              </span>
            </div>
            
            <!-- Label -->
            <h3 class="text-white text-lg md:text-xl font-medium tracking-wide">
              {stat.label}
            </h3>
            
            <!-- Animated Green Line -->
            <div class="relative mt-6">
              <div class="w-full h-1 bg-white/20 rounded-full overflow-hidden">
                <div class="stat-progress h-full bg-gradient-to-r from-green-400 to-green-500 rounded-full transform translate-x-0 transition-transform duration-500 group-hover:-translate-x-full"></div>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  // Intersection Observer for triggering animations
  const observerOptions = {
    threshold: 0.5,
    rootMargin: '0px 0px -100px 0px'
  };

  // Counter animation function
  function animateCounter(element: HTMLElement, target: number, suffix: string): void {
    let current = 0;
    const increment = target / 100; // Adjust speed
    const duration = 2000; // 2 seconds
    const stepTime = duration / 100;
    
    const timer = setInterval(() => {
      current += increment;
      
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      
      element.textContent = Math.floor(current) + suffix;
    }, stepTime);
  }

  // Intersection Observer callback
  function handleIntersection(entries: IntersectionObserverEntry[]): void {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const target = entry.target as HTMLElement;
        const numbers = target.querySelectorAll('.stat-number') as NodeListOf<HTMLElement>;
        const progressBars = target.querySelectorAll('.stat-progress') as NodeListOf<HTMLElement>;
        
        // Animate numbers
        numbers.forEach((numberElement) => {
          const targetValue = parseInt(numberElement.getAttribute('data-target') || '0');
          const suffix = numberElement.getAttribute('data-suffix') || '';
          
          // Reset and animate
          numberElement.textContent = '0' + suffix;
          setTimeout(() => {
            animateCounter(numberElement, targetValue, suffix);
          }, 200);
        });
        
        // Animate progress bars with staggered delay
        progressBars.forEach((bar, index) => {
          bar.style.transform = 'translateX(-100%)';
          bar.style.width = '0%';
          
          setTimeout(() => {
            bar.style.transition = 'all 1.5s ease-out';
            bar.style.transform = 'translateX(0)';
            bar.style.width = '100%';
          }, 300 + (index * 100));
        });
        
        // Unobserve after animation
        observer.unobserve(target);
      }
    });
  }

  // Initialize observer
  const observer = new IntersectionObserver(handleIntersection, observerOptions);

  // Observe the stats section when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    const statsSection = document.querySelector('section:has(.stat-number)') as HTMLElement;
    if (statsSection) {
      observer.observe(statsSection);
    }
  });

  // Enhanced hover effects
  document.addEventListener('DOMContentLoaded', () => {
    const statCards = document.querySelectorAll('.group');
    
    statCards.forEach((card) => {
      card.addEventListener('mouseenter', () => {
        // Add extra glow effect
        const cardElement = card.querySelector('div') as HTMLElement;
        if (cardElement) {
          cardElement.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1)';
        }
      });
      
      card.addEventListener('mouseleave', () => {
        // Reset glow effect
        const cardElement = card.querySelector('div') as HTMLElement;
        if (cardElement) {
          cardElement.style.boxShadow = '';
        }
      });
    });
  });

  // Add staggered animation on initial load
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.group');
    
    cards.forEach((card, index) => {
      const cardElement = card.querySelector('div') as HTMLElement;
      if (cardElement) {
        cardElement.style.opacity = '0';
        cardElement.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
          cardElement.style.transition = 'all 0.6s ease-out';
          cardElement.style.opacity = '1';
          cardElement.style.transform = 'translateY(0)';
        }, index * 150);
      }
    });
  });
</script>

<style>
  /* Custom styles for enhanced effects */
  .stat-number {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    font-weight: 700;
  }
  
  .group:hover .stat-number {
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
    transform: scale(1.05);
    transition: all 0.3s ease;
  }
  
  /* Green line animation */
  .stat-progress {
    background: linear-gradient(90deg, #10b981, #059669, #047857);
    box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
  }
  
  /* Backdrop blur enhancement */
  .group > div {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  /* Responsive typography */
  @media (max-width: 768px) {
    .stat-number {
      font-size: 2.5rem;
    }
  }
  
  @media (max-width: 640px) {
    .stat-number {
      font-size: 2rem;
    }
  }
</style>
