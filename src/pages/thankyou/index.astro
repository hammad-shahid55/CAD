---
import ThankyouLayout from '@/layouts/thankyouLayout.astro';
import { token as newToken } from '@/data/token.ts';
// ThankYou.astro
export interface Props {
  type?: 'quote' | 'contact';
  title?: string;
  subtitle?: string;
  redirectUrl?: string;
  redirectDelay?: number;
}

const { 
  type = 'contact',
  title,
  subtitle,
  redirectUrl = '/',
  redirectDelay = 5000
} = Astro.props;

// Token validation
const VALID_TOKEN =newToken;
const token = Astro.url.searchParams.get('token');

// Redirect if token is missing or invalid
if (token !== VALID_TOKEN) {
  return Astro.redirect(redirectUrl);
}

// Dynamic content
const content = {
  quote: {
    title: title || "Quote Request Received!",
    subtitle: subtitle || "We'll review your requirements and get back to you within 24 hours.",
    icon: "üíº",
    message: "Our team is already working on your custom quote."
  },
  contact: {
    title: title || "Message Received!",
    subtitle: subtitle || "Thank you for reaching out. We'll get back to you soon.",
    icon: "‚úâÔ∏è",
    message: "We appreciate you taking the time to contact us."
  }
};

const currentContent = content[type];
---

<ThankyouLayout title={currentContent.title}>
<div class=" flex items-center justify-center px-4 py-8 overflow-hidden min-h-[80dvh]">
  <div class="w-full max-w-md fade-in-animation">
    <!-- Main Card -->
    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-black/5 p-8 text-center thank-you-card">
      
      <!-- Success Icon -->
      <div class="success-icon-container mb-6">
        <div class="success-icon">
          <svg class="w-16 h-16 text-green-500 mx-auto checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <div class="success-circle"></div>
      </div>

      <!-- Content -->
      <div class="content-fade-in">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4 tracking-tight">
          {currentContent.title}
        </h1>
        
        <p class="text-gray-600 mb-6 leading-relaxed">
          {currentContent.subtitle}
        </p>

        <!-- Feature Message -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-4 mb-8 message-slide-up">
          <div class="flex items-start space-x-3">
            <span class="text-2xl flex-shrink-0 mt-1">{currentContent.icon}</span>
            <p class="text-sm text-gray-700 font-medium">
              {currentContent.message}
            </p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="space-y-3 buttons-fade-in">
          <a 
            href={redirectUrl}
            class="block w-full bg-primary hover:bg-primary/80 text-white font-semibold py-4 px-6 rounded-2xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95"
          >
            Back to Home
          </a>
          
          <button 
            onclick="window.print()" 
            class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-3 px-6 rounded-2xl transition-all duration-300 hover:shadow-md"
          >
            Print Confirmation
          </button>
        </div>

        <!-- Auto redirect notice -->
        <p class="text-xs text-gray-500 mt-6 redirect-notice">
          You'll be redirected in <span id="countdown">5</span> seconds
        </p>
      </div>
    </div>

    <!-- Floating Elements -->
    <div class="floating-elements">
      <div class="floating-circle floating-circle-1"></div>
      <div class="floating-circle floating-circle-2"></div>
      <div class="floating-circle floating-circle-3"></div>
    </div>
  </div>
</div>
</ThankyouLayout>

<style>
  /* Base Animation */
  .fade-in-animation {
    animation: fadeIn 0.8s ease-out forwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Success Icon Animations */
  .success-icon-container {
    position: relative;
    display: inline-block;
  }

  .success-icon {
    animation: iconPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.3s forwards;
    opacity: 0;
    transform: scale(0);
  }

  .success-circle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 80px;
    height: 80px;
    border: 3px solid #10b981;
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(0);
    animation: circleGrow 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.1s forwards;
    opacity: 0.3;
  }

  @keyframes iconPop {
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes circleGrow {
    to { transform: translate(-50%, -50%) scale(1); }
  }

  .checkmark {
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
    animation: checkmarkDraw 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.5s forwards;
  }

  @keyframes checkmarkDraw {
    to { stroke-dashoffset: 0; }
  }

  /* Content Animations */
  .content-fade-in {
    animation: contentFadeIn 0.6s ease-out 0.5s forwards;
    opacity: 0;
    transform: translateY(10px);
  }

  @keyframes contentFadeIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .message-slide-up {
    animation: messageSlideUp 0.5s ease-out 0.7s forwards;
    opacity: 0;
    transform: translateY(15px);
  }

  @keyframes messageSlideUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .buttons-fade-in {
    animation: buttonsFadeIn 0.5s ease-out 0.9s forwards;
    opacity: 0;
    transform: translateY(15px);
  }

  @keyframes buttonsFadeIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .redirect-notice {
    animation: noticeFadeIn 0.4s ease-out 1.1s forwards;
    opacity: 0;
  }

  @keyframes noticeFadeIn {
    to { opacity: 1; }
  }

  /* Floating Background Elements */
  .floating-elements {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
  }

  .floating-circle {
    position: absolute;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(99, 102, 241, 0.1));
    border-radius: 50%;
    animation: float 6s ease-in-out infinite;
    opacity: 0.6;
  }

  .floating-circle-1 {
    width: 120px;
    height: 120px;
    top: 20%;
    left: 10%;
  }

  .floating-circle-2 {
    width: 80px;
    height: 80px;
    top: 60%;
    right: 15%;
    animation-delay: 2s;
  }

  .floating-circle-3 {
    width: 60px;
    height: 60px;
    top: 80%;
    left: 20%;
    animation-delay: 4s;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation: none !important;
      transition: none !important;
    }
  }
</style>

<script is:inline>
  // Client-side validation
  (function() {
    // Check token first
    const urlToken = new URLSearchParams(window.location.search).get('token');
    const validToken = 'Xmx3B8D12Cb35hgEYhG92oqkkrk2CAPo8gu41PBnP7g4vjUNkFJL7K5Yp6hNjjEo2Wk5GCDU9CYXgGdg0REj2Vjd1S6wfcFJwoKuqZ2HhdZx7RBBeWqiUMWr9GpBnSGDUhavvb0ISQXgTveVjpTZBe';
    
    if (urlToken !== validToken) {
      window.location.href = '/';
      return;
    }

    // Only setup countdown if token is valid
    const redirectUrl = document.querySelector('a[href]')?.getAttribute('href') || '/';
    let countdown = 10;
    const countdownElement = document.getElementById('countdown');
    
    const timer = setInterval(() => {
      countdown--;
      if (countdownElement) countdownElement.textContent = countdown;
      if (countdown <= 0) {
        clearInterval(timer);
        window.location.href = redirectUrl;
      }
    }, 1000);
    
    // Stop redirect on interaction
    document.addEventListener('click', () => clearInterval(timer));
  })();
</script>